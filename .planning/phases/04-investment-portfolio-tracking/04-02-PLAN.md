---
phase: 04-investment-portfolio-tracking
plan: 02
type: execute
wave: 2
depends_on: [04-01]
files_modified:
  - src/app/(dashboard)/investments/page.tsx
  - src/components/investment-form.tsx
  - src/components/investment-list.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to investments page from dashboard"
    - "User can see list of their investments with current values"
    - "User can add a new investment via form"
    - "New investment appears in list immediately after creation"
  artifacts:
    - path: "src/app/(dashboard)/investments/page.tsx"
      provides: "Investments page with list and add functionality"
      min_lines: 40
    - path: "src/components/investment-form.tsx"
      provides: "Investment entry form component"
      exports: ["InvestmentForm"]
    - path: "src/components/investment-list.tsx"
      provides: "Portfolio list display component"
      exports: ["InvestmentList"]
  key_links:
    - from: "src/app/(dashboard)/investments/page.tsx"
      to: "getInvestments from db.ts"
      via: "useEffect data fetch"
      pattern: "getInvestments\\(\\)"
    - from: "src/components/investment-form.tsx"
      to: "createInvestment from db.ts"
      via: "form onSubmit handler"
      pattern: "createInvestment\\("
    - from: "src/components/investment-list.tsx"
      to: "DatabaseInvestment type"
      via: "props type definition"
      pattern: "DatabaseInvestment\\[\\]"
---

<objective>
Create investments page with form for adding new investments and list displaying existing portfolio.

Purpose: Enable users to start tracking investments (INV-01, INV-02, INV-03).
Output: Investments page with add form, portfolio list, and real-time data loading.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-investment-portfolio-tracking/04-RESEARCH.md

# Phase 4 database foundation
@.planning/phases/04-investment-portfolio-tracking/04-01-SUMMARY.md

# Existing form patterns
@src/components/expense-form.tsx
@src/components/income-form.tsx
@src/app/(dashboard)/history/page.tsx

# Database operations
@src/lib/db.ts
@src/lib/supabase/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Create investment form component</name>
  <files>src/components/investment-form.tsx</files>
  <action>
Create InvestmentForm component following expense-form.tsx pattern (uncontrolled form with FormData, not useState for each field).

**Component signature:**
```typescript
'use client'
interface InvestmentFormProps {
  onSuccess: () => void  // Callback after successful save
}
export function InvestmentForm({ onSuccess }: InvestmentFormProps)
```

**Form fields (use HTML input elements, not shadcn components for simplicity):**
1. Investment Name - text input, required, placeholder "e.g., Apple Stock, Gold Bar"
2. Category - native select with options: Saham, Emas, Reksadana (use INVESTMENT_CATEGORIES constant)
3. Monthly Contribution - number input, required, placeholder "0", min="1" (in IDR)
4. Current Value - number input, required, placeholder "0", min="1" (in IDR)
5. Purchase Date - date input, required, defaultValue set to today's date
6. Notes - textarea, optional, rows="3"

**Form handling:**
- onSubmit: preventDefault, get FormData, parse values
- Parse integers for monthly_contribution and current_value: parseInt(formData.get('monthly_contribution'), 10)
- Build InsertInvestment object with user_id (from getUserId()), name, category, amounts, purchase_date, notes, timestamp (new Date().toISOString())
- Call createInvestment() from @/lib/db
- On success: reset form, call onSuccess callback
- On error: show error message below form (use state for error display)
- Add loading state during submission (disable submit button)

**Styling:** Use Tailwind classes matching expense-form.tsx pattern (space-y-4, border rounded px-3 py-2, etc).

**Error display:** Red text below form for submission errors.

Import: createInvestment from @/lib/db, getUserId from @/lib/db, INVESTMENT_CATEGORIES from @/lib/supabase/schema.

Follow exact form pattern from expense-form.tsx (FormData, not controlled inputs). Use currency.js formatting if needed for display hints.
  </action>
  <verify>
```bash
# Check component structure
grep -q "export function InvestmentForm" src/components/investment-form.tsx
grep -q "use client" src/components/investment-form.tsx
grep -q "createInvestment" src/components/investment-form.tsx
```
  </verify>
  <done>InvestmentForm component renders form with 6 fields, validates on submit, calls createInvestment(), handles loading and error states, triggers onSuccess callback after save</done>
</task>

<task type="auto">
  <name>Create investment list component</name>
  <files>src/components/investment-list.tsx</files>
  <action>
Create InvestmentList component to display portfolio, similar to TodaySummary transaction list pattern.

**Component signature:**
```typescript
'use client'
import type { DatabaseInvestment } from '@/lib/supabase/schema'

interface InvestmentListProps {
  investments: DatabaseInvestment[]
}
export function InvestmentList({ investments }: InvestmentListProps)
```

**Display structure:**
- If investments.length === 0: Show empty state message "No investments yet. Add your first investment above."
- Otherwise: Map through investments array and render each as a card/row

**Each investment row shows:**
- Name (bold, larger text)
- Category badge (colored pill: Saham=blue, Emas=yellow, Reksadana=green)
- Monthly Contribution: "Rp X/month" (format with currency.js)
- Current Value: "Rp Y" (format with currency.js, bold)
- Purchase Date: "Purchased: YYYY-MM-DD" (format with date-fns if needed, or raw string)
- Notes (if exists, gray text, smaller)

**Styling:**
- Grid or flex layout for investment cards
- Each card: border, rounded, padding, hover effect
- Category badge: inline-block, px-2 py-1, rounded-full, text-xs
- Use Tailwind classes matching project style

**Calculations (optional for this plan):**
- No summary calculations yet (that's Plan 3)
- Just list display

Import: formatCurrency from @/lib/money, DatabaseInvestment from @/lib/supabase/schema.

Order: Display as received (already sorted by created_at DESC from getInvestments).
  </action>
  <verify>
```bash
# Check component structure
grep -q "export function InvestmentList" src/components/investment-list.tsx
grep -q "DatabaseInvestment" src/components/investment-list.tsx
grep -q "investments.length" src/components/investment-list.tsx
```
  </verify>
  <done>InvestmentList component displays investment cards with name, category, amounts, purchase date, and notes; shows empty state when no investments exist</done>
</task>

<task type="auto">
  <name>Create investments page with form and list</name>
  <files>src/app/(dashboard)/investments/page.tsx</files>
  <action>
Create investments page following history/page.tsx pattern (client component with useEffect data loading).

**Page structure:**
```typescript
'use client'

import { useState, useEffect } from 'react'
import { InvestmentForm } from '@/components/investment-form'
import { InvestmentList } from '@/components/investment-list'
import { getInvestments } from '@/lib/db'
import type { DatabaseInvestment } from '@/lib/supabase/schema'

export default function InvestmentsPage() {
  const [investments, setInvestments] = useState<DatabaseInvestment[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  // Load investments on mount
  // Refresh function for onSuccess callback
  // Return JSX
}
```

**Data loading pattern:**
- useEffect on mount: call getInvestments(), setInvestments(data), setLoading(false)
- Catch errors: setError(error.message), setLoading(false)
- Create handleRefresh function: re-runs getInvestments and updates state

**Layout:**
1. Page heading: "Investment Portfolio" (h1, text-2xl font-bold mb-6)
2. InvestmentForm with onSuccess={handleRefresh} (add new investment, auto-refresh list)
3. Divider or spacing
4. Section heading: "Your Investments" (h2, text-xl font-semibold mt-8 mb-4)
5. Loading state: Show "Loading investments..." while loading
6. Error state: Show error message in red if error exists
7. InvestmentList with investments prop

**Container:** Use same container pattern as other pages (max-w-4xl mx-auto p-6).

Follow Phase 3 async pattern: 'use client', useEffect for data loading, loading states, error handling.

Import all components and functions from correct paths. TypeScript strict mode.
  </action>
  <verify>
```bash
# Check page exists and has correct structure
grep -q "export default function InvestmentsPage" src/app/\\(dashboard\\)/investments/page.tsx
grep -q "use client" src/app/\\(dashboard\\)/investments/page.tsx
grep -q "getInvestments" src/app/\\(dashboard\\)/investments/page.tsx
grep -q "InvestmentForm" src/app/\\(dashboard\\)/investments/page.tsx
grep -q "InvestmentList" src/app/\\(dashboard\\)/investments/page.tsx
```
  </verify>
  <done>Investments page renders form at top, list below, loads data on mount with loading/error states, refreshes list after form submission</done>
</task>

</tasks>

<verification>
**Investment entry complete when:**
1. User can navigate to /investments route (even without navigation link yet)
2. Page shows investment form with all 6 fields
3. User can submit form and see new investment in list immediately
4. List displays investments with proper formatting
5. Empty state shows when no investments exist
6. Loading state shows during data fetch
</verification>

<success_criteria>
- InvestmentForm validates input and saves to database via createInvestment()
- InvestmentList renders portfolio with category badges and formatted currency
- Investments page loads data on mount and refreshes after form submission
- TypeScript compiles without errors
- Page follows existing dashboard styling and patterns
</success_criteria>

<output>
After completion, create `.planning/phases/04-investment-portfolio-tracking/04-02-SUMMARY.md`
</output>
