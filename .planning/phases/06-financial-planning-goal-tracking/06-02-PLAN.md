---
phase: 06-financial-planning-goal-tracking
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified:
  - src/app/(dashboard)/goals/page.tsx
  - src/components/goals/goal-form.tsx
  - src/components/goals/goal-list.tsx
  - src/components/goals/goal-row.tsx
  - src/components/navigation.tsx
autonomous: true

must_haves:
  truths:
    - User can create a new goal with name, category, target amount, deadline, priority
    - User can view list of all their goals sorted by deadline
    - User can edit existing goals to update targets or deadlines
    - User can delete goals they no longer need
  artifacts:
    - path: src/app/(dashboard)/goals/page.tsx
      provides: Goal list page with create form
      min_lines: 50
    - path: src/components/goals/goal-form.tsx
      provides: Goal creation/edit form component
      exports: ["GoalForm"]
    - path: src/components/goals/goal-list.tsx
      provides: List of user's goals
      exports: ["GoalList"]
  key_links:
    - from: src/components/goals/goal-form.tsx
      to: db.createGoal/updateGoal
      via: form submission
      pattern: "createGoal\\(|updateGoal\\("
    - from: src/components/goals/goal-list.tsx
      to: db.getGoals
      via: useEffect data loading
      pattern: "getGoals\\(\\)"
---

<objective>
Build goal management UI with creation form, goal list, edit functionality, and navigation integration.

Purpose: Enable users to create and manage financial goals following established form and CRUD patterns from Phases 1-4.
Output: Working goals page accessible from navigation with full CRUD operations.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-financial-planning-goal-tracking/06-CONTEXT.md
@.planning/phases/06-financial-planning-goal-tracking/06-RESEARCH.md
@.planning/phases/06-financial-planning-goal-tracking/06-01-SUMMARY.md

Existing form patterns to reuse:
@src/components/expense-form.tsx
@src/components/navigation.tsx
@src/lib/db.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create goal form component following expense-form pattern</name>
  <files>src/components/goals/goal-form.tsx</files>
  <action>
Create GoalForm component following expense-form.tsx uncontrolled form pattern with FormData:

**Component structure:**
```typescript
'use client'

import { useRef, useState } from 'react'
import { createGoal, updateGoal } from '@/lib/db'
import { GOAL_CATEGORIES, GOAL_PRIORITIES } from '@/lib/supabase/schema'
import type { Goal } from '@/types'

interface GoalFormProps {
  goal?: Goal // If editing
  onSuccess?: () => void
}

export function GoalForm({ goal, onSuccess }: GoalFormProps) {
  const formRef = useRef<HTMLFormElement>(null)
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState('')

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setError('')

    try {
      const formData = new FormData(e.currentTarget as HTMLFormElement)
      const data = {
        name: formData.get('name') as string,
        category: formData.get('category') as string,
        target_amount: parseInt(formData.get('target_amount') as string),
        deadline: formData.get('deadline') as string,
        priority: formData.get('priority') as string,
        funding_notes: formData.get('funding_notes') as string || '',
      }

      if (goal) {
        await updateGoal(goal.id, data)
      } else {
        await createGoal(data)
        formRef.current?.reset()
      }

      onSuccess?.()
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to save goal')
    } finally {
      setLoading(false)
    }
  }

  return (
    <form ref={formRef} onSubmit={handleSubmit} className="space-y-4">
      <div>
        <label htmlFor="name" className="block text-sm font-medium mb-1">
          Goal Name
        </label>
        <input
          type="text"
          id="name"
          name="name"
          defaultValue={goal?.name}
          placeholder="e.g., Wedding, House Down Payment"
          required
          maxLength={100}
          className="w-full px-3 py-2 border rounded-md"
        />
      </div>

      <div>
        <label htmlFor="category" className="block text-sm font-medium mb-1">
          Category
        </label>
        <select
          id="category"
          name="category"
          defaultValue={goal?.category}
          required
          className="w-full px-3 py-2 border rounded-md"
        >
          {GOAL_CATEGORIES.map(cat => (
            <option key={cat} value={cat}>{cat}</option>
          ))}
        </select>
      </div>

      <div>
        <label htmlFor="target_amount" className="block text-sm font-medium mb-1">
          Target Amount (IDR)
        </label>
        <input
          type="number"
          id="target_amount"
          name="target_amount"
          defaultValue={goal?.target_amount}
          placeholder="100000000"
          required
          min="1"
          step="1"
          className="w-full px-3 py-2 border rounded-md"
        />
      </div>

      <div>
        <label htmlFor="deadline" className="block text-sm font-medium mb-1">
          Deadline
        </label>
        <input
          type="date"
          id="deadline"
          name="deadline"
          defaultValue={goal?.deadline}
          required
          min={new Date().toISOString().split('T')[0]} // Future dates only
          className="w-full px-3 py-2 border rounded-md"
        />
      </div>

      <div>
        <label htmlFor="priority" className="block text-sm font-medium mb-1">
          Priority
        </label>
        <select
          id="priority"
          name="priority"
          defaultValue={goal?.priority || 'Medium'}
          required
          className="w-full px-3 py-2 border rounded-md"
        >
          {GOAL_PRIORITIES.map(p => (
            <option key={p} value={p}>{p}</option>
          ))}
        </select>
      </div>

      <div>
        <label htmlFor="funding_notes" className="block text-sm font-medium mb-1">
          Funding Sources (optional)
        </label>
        <textarea
          id="funding_notes"
          name="funding_notes"
          defaultValue={goal?.funding_notes}
          placeholder="e.g., Sell reksadana Rp 77jt + monthly savings Rp 4.5jt"
          maxLength={500}
          rows={3}
          className="w-full px-3 py-2 border rounded-md"
        />
      </div>

      {error && (
        <div className="text-red-600 text-sm">{error}</div>
      )}

      <button
        type="submit"
        disabled={loading}
        className="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400"
      >
        {loading ? 'Saving...' : (goal ? 'Update Goal' : 'Create Goal')}
      </button>
    </form>
  )
}
```

Follow existing form patterns:
- Uncontrolled form with FormData (not React state for inputs)
- Native HTML input types (text, number, date, select, textarea)
- Loading state during submission
- Error display below form
- Form reset after successful creation
- Default values for edit mode
  </action>
  <verify>
grep "export function GoalForm" src/components/goals/goal-form.tsx
grep "FormData" src/components/goals/goal-form.tsx
grep "createGoal\\|updateGoal" src/components/goals/goal-form.tsx
  </verify>
  <done>GoalForm component exists with uncontrolled form using FormData, handles both create and edit modes, shows loading/error states, uses GOAL_CATEGORIES and GOAL_PRIORITIES from schema.</done>
</task>

<task type="auto">
  <name>Task 2: Create goal list and goal row components</name>
  <files>src/components/goals/goal-list.tsx, src/components/goals/goal-row.tsx</files>
  <action>
**Create goal-list.tsx:**
```typescript
'use client'

import { useEffect, useState } from 'react'
import { getGoals } from '@/lib/db'
import type { Goal } from '@/types'
import { GoalRow } from './goal-row'

interface GoalListProps {
  onRefresh?: number // Refresh key for external updates
}

export function GoalList({ onRefresh }: GoalListProps) {
  const [goals, setGoals] = useState<Goal[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    async function load() {
      try {
        setLoading(true)
        const data = await getGoals()
        setGoals(data)
      } catch (err) {
        console.error('Failed to load goals:', err)
      } finally {
        setLoading(false)
      }
    }
    load()
  }, [onRefresh])

  if (loading) {
    return <div className="text-gray-500">Loading goals...</div>
  }

  if (goals.length === 0) {
    return (
      <div className="text-center py-8 text-gray-500">
        <p className="text-lg font-medium">No financial goals yet</p>
        <p className="text-sm mt-2">Create your first goal above to start planning!</p>
      </div>
    )
  }

  return (
    <div className="space-y-3">
      {goals.map(goal => (
        <GoalRow key={goal.id} goal={goal} onUpdate={() => window.location.reload()} />
      ))}
    </div>
  )
}
```

**Create goal-row.tsx:**
```typescript
'use client'

import { useState } from 'react'
import { deleteGoal } from '@/lib/db'
import { IDR } from '@/lib/money'
import type { Goal } from '@/types'

interface GoalRowProps {
  goal: Goal
  onUpdate: () => void
}

export function GoalRow({ goal, onUpdate }: GoalRowProps) {
  const [deleting, setDeleting] = useState(false)

  const handleDelete = async () => {
    if (!confirm(`Delete goal "${goal.name}"? This cannot be undone.`)) return

    try {
      setDeleting(true)
      await deleteGoal(goal.id)
      onUpdate()
    } catch (err) {
      alert('Failed to delete goal')
      setDeleting(false)
    }
  }

  // Badge color by priority
  const priorityColor = {
    High: 'bg-red-100 text-red-800',
    Medium: 'bg-yellow-100 text-yellow-800',
    Low: 'bg-green-100 text-green-800',
  }[goal.priority]

  // Badge color by status
  const statusColor = {
    upcoming: 'bg-gray-100 text-gray-800',
    'in-progress': 'bg-blue-100 text-blue-800',
    completed: 'bg-green-100 text-green-800',
    overdue: 'bg-red-100 text-red-800',
  }[goal.status]

  return (
    <div className="border rounded-lg p-4 bg-white shadow-sm">
      <div className="flex items-start justify-between">
        <div className="flex-1">
          <div className="flex items-center gap-2 mb-1">
            <h3 className="font-semibold text-lg">{goal.name}</h3>
            <span className={`text-xs px-2 py-1 rounded ${priorityColor}`}>
              {goal.priority}
            </span>
            <span className={`text-xs px-2 py-1 rounded ${statusColor}`}>
              {goal.status}
            </span>
          </div>
          <div className="text-sm text-gray-600 space-y-1">
            <p>Category: {goal.category}</p>
            <p>Target: {IDR(goal.target_amount)}</p>
            <p>Deadline: {new Date(goal.deadline).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
            {goal.funding_notes && (
              <p className="text-xs text-gray-500 mt-2">
                Funding: {goal.funding_notes}
              </p>
            )}
          </div>
        </div>
        <div className="flex gap-2">
          <button
            onClick={handleDelete}
            disabled={deleting}
            className="text-red-600 hover:text-red-800 text-sm px-3 py-1 border border-red-600 rounded disabled:opacity-50"
          >
            {deleting ? 'Deleting...' : 'Delete'}
          </button>
        </div>
      </div>
    </div>
  )
}
```

Follow patterns:
- GoalList uses useEffect + getGoals (like TodaySummary component)
- Empty state with friendly messaging
- GoalRow displays goal details with color-coded badges
- Delete confirmation using native confirm() (Phase 2 pattern)
- IDR() formatting from existing money.ts
  </action>
  <verify>
grep "export function GoalList" src/components/goals/goal-list.tsx
grep "export function GoalRow" src/components/goals/goal-row.tsx
grep "getGoals()" src/components/goals/goal-list.tsx
grep "deleteGoal" src/components/goals/goal-row.tsx
  </verify>
  <done>GoalList component loads goals with useEffect, shows empty state when no goals exist. GoalRow displays goal details with priority/status badges, delete button with confirmation.</done>
</task>

<task type="auto">
  <name>Task 3: Create goals page and add navigation link</name>
  <files>src/app/(dashboard)/goals/page.tsx, src/components/navigation.tsx</files>
  <action>
**Create goals/page.tsx:**
```typescript
'use client'

import { useState } from 'react'
import { GoalForm } from '@/components/goals/goal-form'
import { GoalList } from '@/components/goals/goal-list'

export default function GoalsPage() {
  const [refreshKey, setRefreshKey] = useState(0)

  const handleGoalCreated = () => {
    setRefreshKey(prev => prev + 1) // Trigger list refresh
  }

  return (
    <div className="max-w-4xl mx-auto">
      <div className="mb-6">
        <h1 className="text-3xl font-bold">Financial Goals</h1>
        <p className="text-gray-600 mt-1">
          Plan and track your financial goals with target amounts and deadlines
        </p>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Create goal form - left column on desktop */}
        <div className="lg:col-span-1">
          <div className="border rounded-lg p-4 bg-white shadow-sm">
            <h2 className="text-xl font-semibold mb-4">Create Goal</h2>
            <GoalForm onSuccess={handleGoalCreated} />
          </div>
        </div>

        {/* Goal list - right 2 columns on desktop */}
        <div className="lg:col-span-2">
          <h2 className="text-xl font-semibold mb-4">Your Goals</h2>
          <GoalList onRefresh={refreshKey} />
        </div>
      </div>
    </div>
  )
}
```

**Update navigation.tsx:** Add "Goals" link between "Investments" and "Monthly":
```typescript
// Find the navigation items array and add:
{ href: '/goals', label: 'Goals' }
```

Position between existing Investments and Monthly links. Follow exact pattern from existing navigation items.
  </action>
  <verify>
cat src/app/(dashboard)/goals/page.tsx | grep "Financial Goals"
grep "'/goals'" src/components/navigation.tsx
  </verify>
  <done>Goals page exists with GoalForm and GoalList in responsive grid layout. Navigation includes "Goals" link accessible from all dashboard pages.</done>
</task>

</tasks>

<verification>
Run after all tasks:
1. Verify GoalForm uses FormData pattern matching expense-form
2. Verify GoalList loads data with useEffect and shows empty state
3. Verify GoalRow displays goal details with priority/status badges
4. Verify goals page renders form and list in grid layout
5. Verify navigation includes Goals link
</verification>

<success_criteria>
- User can navigate to /goals from any dashboard page
- User can create a goal with all required fields (name, category, target, deadline, priority)
- User can view list of goals sorted by deadline
- User can delete goals with confirmation dialog
- Form resets after successful goal creation
- Goal list refreshes after creation/deletion
- Empty state shows when no goals exist
- Priority and status badges display with appropriate colors
</success_criteria>

<output>
After completion, create `.planning/phases/06-financial-planning-goal-tracking/06-02-SUMMARY.md`
</output>
