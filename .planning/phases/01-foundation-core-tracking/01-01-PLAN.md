---
phase: 01-foundation-core-tracking
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - tailwind.config.ts
  - next.config.ts
  - components.json
  - src/types/index.ts
  - src/lib/validation.ts
  - src/lib/storage.ts
  - src/lib/money.ts
  - src/lib/date.ts
  - src/components/ui/*
autonomous: true

must_haves:
  truths:
    - "Next.js 15 project builds and runs with `npm run dev`"
    - "TypeScript types exist for Transaction, Expense, Income with proper typing"
    - "Zod schemas validate expense and income data correctly"
    - "localStorage abstraction handles SSR hydration safely"
    - "Monetary calculations use currency.js (no floating-point)"
    - "Date utilities use timezone-aware date-fns with Asia/Jakarta"
  artifacts:
    - path: "src/types/index.ts"
      provides: "Transaction, Expense, Income, Category types"
      contains: "Transaction"
    - path: "src/lib/validation.ts"
      provides: "Zod schemas for expense and income"
      contains: "expenseSchema"
    - path: "src/lib/storage.ts"
      provides: "localStorage CRUD with hydration guard"
      exports: ["getTransactions", "addTransaction"]
    - path: "src/lib/money.ts"
      provides: "IDR currency formatting"
      contains: "currency"
    - path: "src/lib/date.ts"
      provides: "Timezone-aware date utilities"
      contains: "Asia/Jakarta"
  key_links:
    - from: "src/lib/storage.ts"
      to: "src/types/index.ts"
      via: "imports Transaction type"
      pattern: "import.*Transaction.*from.*types"
    - from: "src/lib/validation.ts"
      to: "src/types/index.ts"
      via: "validates against Transaction shape"
      pattern: "import.*from.*types"
---

<objective>
Set up the Next.js 15 project with all foundational types, validation schemas, and utility libraries that every subsequent plan depends on.

Purpose: Establish the project skeleton and shared infrastructure so Plans 02 and 03 can build features in parallel without conflicts.
Output: Runnable Next.js app with TypeScript types, Zod validation, localStorage abstraction, currency.js money helpers, and date-fns timezone utilities.
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-tracking/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 15 project and install dependencies</name>
  <files>
    package.json
    tsconfig.json
    tailwind.config.ts
    next.config.ts
    components.json
    src/app/layout.tsx
    src/app/globals.css
    src/components/ui/*
  </files>
  <action>
    Run `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*" --turbopack` in the project root. Choose defaults for prompts. The project root already has a .planning directory and .git -- create-next-app should work in a non-empty directory.

    If create-next-app refuses to run in a non-empty directory, use `--yes` flag or create in a temp directory and move files back.

    After scaffold, install Phase 1 dependencies:
    ```bash
    npm install zod currency.js date-fns @date-fns/tz papaparse
    npm install -D @types/papaparse
    ```

    Initialize shadcn/ui:
    ```bash
    npx shadcn@latest init -d
    ```

    Add required shadcn components:
    ```bash
    npx shadcn@latest add button input select label card
    ```

    Verify the project compiles:
    ```bash
    npm run build
    ```
  </action>
  <verify>
    `npm run build` completes without errors. `package.json` contains zod, currency.js, date-fns, @date-fns/tz, papaparse.
  </verify>
  <done>
    Next.js 15 project scaffolded with TypeScript, Tailwind CSS, shadcn/ui, and all Phase 1 dependencies installed. Project builds successfully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TypeScript types and Zod validation schemas</name>
  <files>
    src/types/index.ts
    src/lib/validation.ts
  </files>
  <action>
    Create `src/types/index.ts` with these types:

    ```typescript
    export type Category = 'Makan' | 'Transportasi' | 'Rokok' | 'Belanja' | 'Lainnya'

    export const CATEGORIES: Category[] = ['Makan', 'Transportasi', 'Rokok', 'Belanja', 'Lainnya']

    export interface Transaction {
      id: string                          // crypto.randomUUID()
      type: 'expense' | 'income'
      amount: number                      // Store as integer (no decimals for IDR)
      category: Category | 'Income'       // 'Income' for income entries
      notes: string                       // Empty string if none
      date: string                        // ISO 8601 date string (YYYY-MM-DD)
      timestamp: string                   // Full ISO 8601 datetime for ordering
      createdAt: string                   // Audit trail
    }

    export type NewExpense = {
      amount: number
      category: Category
      notes: string
    }

    export type NewIncome = {
      amount: number
      notes: string
    }

    export interface MonthSummary {
      month: string                       // 'YYYY-MM' format
      totalExpenses: number
      totalIncome: number
      byCategory: Record<Category, number>
    }

    export interface FormState {
      success: boolean
      message: string
      errors?: Record<string, string[]>
    }
    ```

    Create `src/lib/validation.ts` with Zod schemas:

    ```typescript
    import { z } from 'zod'
    import { CATEGORIES } from '@/types'

    export const expenseSchema = z.object({
      amount: z.string()
        .min(1, 'Amount is required')
        .regex(/^\d+$/, 'Amount must be a whole number (IDR has no cents)')
        .transform(Number)
        .pipe(z.number().positive('Amount must be positive')),
      category: z.enum(['Makan', 'Transportasi', 'Rokok', 'Belanja', 'Lainnya'] as const, {
        errorMap: () => ({ message: 'Please select a category' }),
      }),
      notes: z.string().max(200, 'Notes must be under 200 characters').default(''),
    })

    export const incomeSchema = z.object({
      amount: z.string()
        .min(1, 'Amount is required')
        .regex(/^\d+$/, 'Amount must be a whole number')
        .transform(Number)
        .pipe(z.number().positive('Amount must be positive')),
      notes: z.string().max(200, 'Notes must be under 200 characters').default(''),
    })

    export type ExpenseInput = z.input<typeof expenseSchema>
    export type IncomeInput = z.input<typeof incomeSchema>
    ```

    IDR (Indonesian Rupiah) does not use cents, so amounts are always whole numbers. The regex enforces digits-only input, then transforms to number.
  </action>
  <verify>
    `npx tsc --noEmit` passes. Types are properly exported and validation schemas parse correctly.
  </verify>
  <done>
    Transaction, Expense, Income types defined. Zod schemas validate amount (whole number, positive), category (fixed enum), and notes (max 200 chars). Types are importable from `@/types` and schemas from `@/lib/validation`.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create core utility libraries (storage, money, date)</name>
  <files>
    src/lib/storage.ts
    src/lib/money.ts
    src/lib/date.ts
  </files>
  <action>
    Create `src/lib/money.ts` -- Currency formatting with currency.js:

    ```typescript
    import currency from 'currency.js'

    // IDR format: Rp 125.000 (period separator, no decimal for Rupiah)
    export const IDR = (value: number | string) =>
      currency(value, {
        symbol: 'Rp ',
        separator: '.',
        decimal: ',',
        precision: 0,
      })

    // Format number as IDR string
    export function formatIDR(amount: number): string {
      return IDR(amount).format()
    }

    // Sum an array of amounts safely
    export function sumAmounts(amounts: number[]): number {
      return amounts.reduce((total, amt) => IDR(total).add(amt).value, 0)
    }
    ```

    Create `src/lib/date.ts` -- Timezone-aware date utilities:

    ```typescript
    import { TZDate } from '@date-fns/tz'
    import { format, startOfDay, startOfMonth, endOfMonth, isWithinInterval, parseISO } from 'date-fns'

    const TIMEZONE = 'Asia/Jakarta'

    // Get current time in Jakarta timezone
    export function now(): Date {
      return new TZDate(new Date(), TIMEZONE)
    }

    // Get today's date as YYYY-MM-DD
    export function todayDateString(): string {
      return format(now(), 'yyyy-MM-dd')
    }

    // Get current month as YYYY-MM
    export function currentMonthString(): string {
      return format(now(), 'yyyy-MM')
    }

    // Format a date string for display (e.g., "14 Feb 2026")
    export function formatDisplayDate(dateStr: string): string {
      return format(parseISO(dateStr), 'dd MMM yyyy')
    }

    // Format a date string for display with time (e.g., "14 Feb 2026, 14:30")
    export function formatDisplayDateTime(timestamp: string): string {
      return format(parseISO(timestamp), 'dd MMM yyyy, HH:mm')
    }

    // Check if a date string is today
    export function isToday(dateStr: string): boolean {
      return dateStr === todayDateString()
    }

    // Get month string from a date (YYYY-MM)
    export function getMonthFromDate(dateStr: string): string {
      return dateStr.substring(0, 7)
    }

    // Get all unique months from date strings, sorted descending
    export function getUniqueMonths(dates: string[]): string[] {
      const months = [...new Set(dates.map(d => getMonthFromDate(d)))]
      return months.sort().reverse()
    }

    // Format month string for display (e.g., "February 2026")
    export function formatMonth(monthStr: string): string {
      return format(parseISO(monthStr + '-01'), 'MMMM yyyy')
    }
    ```

    Create `src/lib/storage.ts` -- localStorage abstraction with hydration guard:

    ```typescript
    import { Transaction, Category, CATEGORIES, NewExpense, NewIncome, MonthSummary } from '@/types'
    import { todayDateString, currentMonthString, getMonthFromDate, isToday } from '@/lib/date'
    import { sumAmounts } from '@/lib/money'

    const STORAGE_KEY = 'finance-tracker-transactions'

    // SSR guard: returns empty on server
    function isClient(): boolean {
      return typeof window !== 'undefined'
    }

    // Read all transactions from localStorage
    export function getTransactions(): Transaction[] {
      if (!isClient()) return []
      try {
        const data = localStorage.getItem(STORAGE_KEY)
        return data ? JSON.parse(data) : []
      } catch {
        return []
      }
    }

    // Save all transactions (internal use only)
    function saveTransactions(transactions: Transaction[]): void {
      if (!isClient()) return
      localStorage.setItem(STORAGE_KEY, JSON.stringify(transactions))
    }

    // Append a new transaction (append-only ledger pattern)
    export function addTransaction(tx: Omit<Transaction, 'id' | 'createdAt'>): Transaction {
      const transactions = getTransactions()
      const newTx: Transaction = {
        ...tx,
        id: crypto.randomUUID(),
        createdAt: new Date().toISOString(),
      }
      transactions.push(newTx)
      saveTransactions(transactions)
      return newTx
    }

    // Add expense helper
    export function addExpense(expense: NewExpense): Transaction {
      const dateStr = todayDateString()
      return addTransaction({
        type: 'expense',
        amount: expense.amount,
        category: expense.category,
        notes: expense.notes,
        date: dateStr,
        timestamp: new Date().toISOString(),
      })
    }

    // Add income helper
    export function addIncome(income: NewIncome): Transaction {
      const dateStr = todayDateString()
      return addTransaction({
        type: 'income',
        amount: income.amount,
        category: 'Income',
        notes: income.notes,
        date: dateStr,
        timestamp: new Date().toISOString(),
      })
    }

    // Get today's transactions
    export function getTodayTransactions(): Transaction[] {
      return getTransactions().filter(tx => isToday(tx.date))
    }

    // Get today's total spending
    export function getTodayTotal(): number {
      const todayExpenses = getTodayTransactions().filter(tx => tx.type === 'expense')
      return sumAmounts(todayExpenses.map(tx => tx.amount))
    }

    // Get transactions for a specific month (YYYY-MM)
    export function getMonthTransactions(month: string): Transaction[] {
      return getTransactions().filter(tx => getMonthFromDate(tx.date) === month)
    }

    // Calculate monthly summary
    export function getMonthSummary(month: string): MonthSummary {
      const transactions = getMonthTransactions(month)
      const expenses = transactions.filter(tx => tx.type === 'expense')
      const income = transactions.filter(tx => tx.type === 'income')

      const byCategory = {} as Record<Category, number>
      for (const cat of CATEGORIES) {
        byCategory[cat] = sumAmounts(
          expenses.filter(tx => tx.category === cat).map(tx => tx.amount)
        )
      }

      return {
        month,
        totalExpenses: sumAmounts(expenses.map(tx => tx.amount)),
        totalIncome: sumAmounts(income.map(tx => tx.amount)),
        byCategory,
      }
    }
    ```

    Key implementation notes:
    - All functions guard against SSR with `typeof window === 'undefined'` check
    - Storage is append-only (no update/delete functions -- that's Phase 2)
    - Amounts are integers (IDR has no cents)
    - currency.js handles all arithmetic to avoid floating-point errors
    - date-fns with @date-fns/tz handles timezone-aware dates
  </action>
  <verify>
    `npx tsc --noEmit` passes. All three files compile without errors. Imports between files resolve correctly.
  </verify>
  <done>
    Three utility libraries created: money.ts (IDR formatting via currency.js), date.ts (timezone-aware with Asia/Jakarta via date-fns), storage.ts (localStorage CRUD with SSR guard, append-only pattern). All properly typed and interconnected.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npx tsc --noEmit` reports no type errors
3. All files exist: src/types/index.ts, src/lib/validation.ts, src/lib/storage.ts, src/lib/money.ts, src/lib/date.ts
4. Dependencies in package.json: zod, currency.js, date-fns, @date-fns/tz, papaparse
5. shadcn/ui components available: button, input, select, label, card
</verification>

<success_criteria>
- Project builds with `npm run build`
- Types importable via `@/types`
- Libraries importable via `@/lib/storage`, `@/lib/money`, `@/lib/date`
- Validation schemas importable via `@/lib/validation`
- shadcn/ui components render without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-tracking/01-01-SUMMARY.md`
</output>
