---
phase: 02-dashboard-visualization
plan: 03
type: execute
wave: 2
depends_on: []
files_modified:
  - src/lib/storage.ts
  - src/components/today-summary.tsx
  - src/components/ui/dialog.tsx
  - src/components/transaction-actions.tsx
autonomous: true

must_haves:
  truths:
    - "User can edit today's transactions to correct mistakes"
    - "User can delete today's transactions"
    - "Edit button opens modal with pre-filled form"
    - "Delete button shows confirmation dialog before deleting"
    - "Three-dot menu appears on each transaction row on Today page only"
    - "Transaction list refreshes immediately after edit or delete"
  artifacts:
    - path: "src/lib/storage.ts"
      provides: "Transaction update and delete functions"
      exports: ["updateTransaction", "deleteTransaction"]
    - path: "src/components/ui/dialog.tsx"
      provides: "shadcn/ui Dialog component for edit modal"
      min_lines: 20
    - path: "src/components/transaction-actions.tsx"
      provides: "Three-dot menu with edit/delete and edit modal"
      min_lines: 80
    - path: "src/components/today-summary.tsx"
      provides: "Updated transaction list with action menu"
      contains: "TransactionActions"
  key_links:
    - from: "src/components/today-summary.tsx"
      to: "src/components/transaction-actions.tsx"
      via: "render TransactionActions per row"
      pattern: "TransactionActions.*transaction"
    - from: "src/components/transaction-actions.tsx"
      to: "src/lib/storage.ts"
      via: "updateTransaction and deleteTransaction calls"
      pattern: "(updateTransaction|deleteTransaction)"
    - from: "src/components/transaction-actions.tsx"
      to: "native confirm()"
      via: "delete confirmation dialog"
      pattern: "confirm\\("
    - from: "src/components/transaction-actions.tsx"
      to: "Dialog component"
      via: "edit modal"
      pattern: "Dialog.*DialogContent"
---

<objective>
Add edit and delete transaction capabilities on Today page with three-dot menu and modal

Purpose: Allow users to correct mistakes in today's transactions only
Output: Working edit modal and delete confirmation accessible via three-dot menu on Today page
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-visualization/02-CONTEXT.md
@.planning/phases/02-dashboard-visualization/02-RESEARCH.md

## Phase 1 Foundation
@.planning/phases/01-foundation-core-tracking/01-01-SUMMARY.md
@.planning/phases/01-foundation-core-tracking/01-02-SUMMARY.md

## Existing Code
@src/types/index.ts
@src/lib/storage.ts
@src/lib/validation.ts
@src/components/today-summary.tsx
@src/components/expense-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add update and delete functions to storage library and install shadcn Dialog</name>
  <files>
    src/lib/storage.ts
    src/components/ui/dialog.tsx
  </files>
  <action>
Update `src/lib/storage.ts` with transaction modification functions:

Add `updateTransaction(id: string, updates: Partial<Transaction>): void`:
- Get existing transactions via getTransactions()
- Find transaction by id
- Merge updates with existing transaction (keep id and createdAt unchanged)
- Replace transaction in array
- Save back to localStorage with saveTransactions()
- SSR guard with typeof window check (consistent with existing storage functions)

Add `deleteTransaction(id: string): void`:
- Get existing transactions via getTransactions()
- Filter out transaction with matching id
- Save filtered array back to localStorage with saveTransactions()
- SSR guard with typeof window check

IMPORTANT: These functions modify the ledger (breaking append-only pattern from Phase 1). This is intentional for Phase 2 - user explicitly requested edit/delete capability.

Install shadcn/ui Dialog component for edit modal:
```bash
npx shadcn@latest add dialog
```

This installs dialog.tsx in src/components/ui/ with Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, etc.

Verification: Check Dialog component exists and TypeScript compiles without errors
  </action>
  <verify>
Check updateTransaction and deleteTransaction exist:
```bash
grep -n "export.*updateTransaction\|export.*deleteTransaction" src/lib/storage.ts
```

Check Dialog component installed:
```bash
ls src/components/ui/dialog.tsx
```

TypeScript check:
```bash
npx tsc --noEmit
```
  </verify>
  <done>
- src/lib/storage.ts exports updateTransaction and deleteTransaction functions
- Both functions have SSR guards (typeof window check)
- src/components/ui/dialog.tsx exists with Dialog components
- TypeScript compilation succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Create transaction actions component with three-dot menu and edit modal</name>
  <files>
    src/components/transaction-actions.tsx
  </files>
  <action>
Create `src/components/transaction-actions.tsx` with three-dot menu and edit modal:

Use 'use client' directive

Import:
- Dialog, DialogContent, DialogHeader, DialogTitle from @/components/ui/dialog
- Button, Input, Label from @/components/ui (shadcn components)
- updateTransaction, deleteTransaction from @/lib/storage
- Transaction, Category type from @/types
- expenseSchema, incomeSchema from @/lib/validation
- formatIDR from @/lib/money
- useState from 'react'

Component props:
- `transaction: Transaction` - the transaction to edit/delete
- `onUpdate: () => void` - callback to refresh transaction list after edit/delete

Component structure:

1. State management:
   - `isMenuOpen` - controls three-dot menu visibility
   - `isEditOpen` - controls edit modal visibility
   - `formData` - edited transaction data (initialized from transaction prop)
   - `errors` - validation errors from Zod

2. Three-dot menu button:
   - Button with "⋮" (vertical ellipsis) as text
   - onClick toggles isMenuOpen
   - Positioned on right side of transaction row
   - Small, subtle styling

3. Menu dropdown (when isMenuOpen = true):
   - Absolute positioned div appearing below button
   - "Edit" option → opens edit modal (setIsEditOpen(true), setIsMenuOpen(false))
   - "Delete" option → shows confirm dialog and deletes
   - Click outside to close (onBlur or useEffect with click listener)

4. Delete handler:
   - Show native confirm() dialog: "Are you sure you want to delete this transaction?"
   - If confirmed: call deleteTransaction(transaction.id), then onUpdate() to refresh list
   - Close menu

5. Edit modal (Dialog):
   - DialogContent with edit form
   - Pre-fill form fields with transaction data
   - Fields: amount (Input), category (native select), notes (Input)
   - Type (expense vs income) is read-only (show as label, don't allow changing type)
   - Validate with appropriate schema (expenseSchema or incomeSchema) on submit
   - Save button: validate, call updateTransaction(transaction.id, formData), close modal, call onUpdate()
   - Cancel button: close modal without saving

6. Form validation:
   - Use Zod safeParse on submit
   - Show validation errors below fields
   - Only submit if validation passes

Styling:
- Use Tailwind for layout
- Menu should have border, shadow, white background
- Form should be clean with shadcn/ui components
  </action>
  <verify>
Check file exists and exports component:
```bash
grep -n "export.*TransactionActions" src/components/transaction-actions.tsx
```

Verify Dialog and storage imports:
```bash
grep -n "from '@/components/ui/dialog'" src/components/transaction-actions.tsx
grep -n "from '@/lib/storage'" src/components/transaction-actions.tsx
```

TypeScript check:
```bash
npx tsc --noEmit
```
  </verify>
  <done>
- src/components/transaction-actions.tsx exists
- Component renders three-dot menu button
- Menu shows Edit and Delete options
- Delete uses native confirm() dialog
- Edit opens Dialog modal with pre-filled form
- Form validates with Zod before saving
- Component calls updateTransaction and deleteTransaction
- Component triggers onUpdate callback after mutations
- TypeScript compilation succeeds
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate transaction actions into Today page transaction list</name>
  <files>
    src/components/today-summary.tsx
  </files>
  <action>
Update `src/components/today-summary.tsx` to include TransactionActions:

Import:
- TransactionActions from @/components/transaction-actions

Modify transaction list rendering:
- Each transaction row should include TransactionActions component on the right side
- Pass transaction object and onUpdate callback (use existing refreshKey pattern)
- Layout: flex row with transaction details on left, TransactionActions on right

OnUpdate callback:
- Increment refreshKey state (or use similar pattern to re-fetch transactions)
- This will trigger component re-render and reload from localStorage
- Ensures list updates immediately after edit or delete

Scoping:
- Transaction actions should ONLY appear on Today page (TodaySummary component)
- History page and Monthly page should NOT have edit/delete buttons (per user decision in CONTEXT.md)

Styling:
- Transaction row should accommodate action button without cramping
- Use justify-between or similar flex layout
- Ensure three-dot button is visible but not too prominent
  </action>
  <verify>
Check TodaySummary imports TransactionActions:
```bash
grep -n "TransactionActions" src/components/today-summary.tsx
```

Build check:
```bash
npm run build
```
Should complete without errors.
  </verify>
  <done>
- TodaySummary component imports and renders TransactionActions
- TransactionActions appears on right side of each transaction row
- onUpdate callback refreshes transaction list after edit/delete
- Build succeeds without errors
- Edit and delete functionality works on Today page only
  </done>
</task>

</tasks>

<verification>
After task completion, verify phase goals:

1. Manual check: Run `npm run dev`, navigate to Today page
2. Add a test transaction if none exist
3. Verify three-dot menu (⋮) appears on right side of transaction row
4. Click three-dot menu and verify Edit and Delete options appear
5. Click Edit and verify modal opens with pre-filled form
6. Edit a field and save - verify transaction updates and list refreshes
7. Click Delete and verify confirm dialog appears
8. Confirm delete and verify transaction is removed and list refreshes
9. Verify History and Monthly pages do NOT show edit/delete buttons
</verification>

<success_criteria>
- User can edit today's transactions via modal form
- User can delete today's transactions with confirmation
- Three-dot menu appears on Today page transaction rows only
- Edit modal opens with pre-filled transaction data
- Delete shows native confirm() dialog before removing
- Transaction list refreshes immediately after edit or delete
- Edit and delete do NOT appear on History or Monthly pages
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-visualization/02-03-SUMMARY.md`
</output>
