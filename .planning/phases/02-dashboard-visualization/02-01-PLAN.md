---
phase: 02-dashboard-visualization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/chart-data.ts
  - src/lib/constants.ts
  - src/components/charts/category-breakdown.tsx
  - src/app/(dashboard)/monthly/page.tsx
autonomous: true

must_haves:
  truths:
    - "User sees visual chart showing spending breakdown by category on Monthly page"
    - "Each category (Makan, Transportasi, Rokok, Belanja, Lainnya) has a consistent fixed color"
    - "User can click legend to hide/show specific categories"
    - "Chart displays even with minimal data (no minimum threshold)"
  artifacts:
    - path: "src/lib/chart-data.ts"
      provides: "Data aggregation functions for charts"
      exports: ["aggregateByCategory", "aggregateByMonth"]
    - path: "src/lib/constants.ts"
      provides: "Fixed category color palette"
      exports: ["CATEGORY_COLORS"]
    - path: "src/components/charts/category-breakdown.tsx"
      provides: "Category breakdown pie/doughnut chart"
      min_lines: 40
    - path: "src/app/(dashboard)/monthly/page.tsx"
      provides: "Monthly page with category chart"
      contains: "CategoryBreakdown"
  key_links:
    - from: "src/app/(dashboard)/monthly/page.tsx"
      to: "src/lib/chart-data.ts"
      via: "useMemo data aggregation"
      pattern: "useMemo.*aggregateByCategory"
    - from: "src/components/charts/category-breakdown.tsx"
      to: "recharts"
      via: "ResponsiveContainer + PieChart"
      pattern: "ResponsiveContainer.*PieChart"
    - from: "src/components/charts/category-breakdown.tsx"
      to: "CATEGORY_COLORS"
      via: "import from constants"
      pattern: "import.*CATEGORY_COLORS"
---

<objective>
Install Recharts library and create category breakdown visualization on Monthly page

Purpose: Enable visual spending insights with fixed category colors and interactive legend toggle
Output: Working category pie/doughnut chart on Monthly page with performance-optimized data aggregation
</objective>

<execution_context>
@C:/Users/rinoa/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/rinoa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dashboard-visualization/02-CONTEXT.md
@.planning/phases/02-dashboard-visualization/02-RESEARCH.md

## Phase 1 Foundation
@.planning/phases/01-foundation-core-tracking/01-01-SUMMARY.md
@.planning/phases/01-foundation-core-tracking/01-02-SUMMARY.md
@.planning/phases/01-foundation-core-tracking/01-03-SUMMARY.md

## Existing Code
@src/types/index.ts
@src/lib/storage.ts
@src/lib/money.ts
@src/lib/date.ts
@src/app/(dashboard)/monthly/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts and create chart data aggregation utility</name>
  <files>
    package.json
    src/lib/chart-data.ts
    src/lib/constants.ts
  </files>
  <action>
Install Recharts 3.7.0 for React chart visualization:
```bash
npm install recharts@3.7.0
```

Create `src/lib/constants.ts` with fixed category color palette:
- Export `CATEGORY_COLORS` constant mapping each category to a hex color
- Colors: Makan (blue-ish), Transportasi (yellow-ish), Rokok (red-ish), Belanja (purple-ish), Lainnya (gray-ish)
- These colors will be consistent across all charts in all views

Create `src/lib/chart-data.ts` for performance-optimized data aggregation:
- Import Transaction, Category types from @/types
- Import currency.js for money calculations (consistent with Phase 1)
- Export `aggregateByCategory(transactions: Transaction[], month: string): Record<Category, number>`
  - Filter transactions by month and type='expense'
  - Sum amounts per category using currency.js to avoid floating-point errors
  - Return object mapping each category to total amount
- Export `aggregateByMonth(transactions: Transaction[], monthCount: number): MonthlyTotals[]`
  - Group transactions by month (up to last N months)
  - Calculate total income, total expense, net per month
  - Return array of objects with { month: string, income: number, expense: number, net: number }
- Use currency.js `.value` for raw numbers after calculations
- Keep functions pure (no side effects) for easy memoization with useMemo

Verification: `npx tsc --noEmit` passes without errors
  </action>
  <verify>
Run TypeScript compiler to check types:
```bash
npx tsc --noEmit
```
Should complete with no errors.

Verify Recharts installed:
```bash
npm list recharts
```
Should show recharts@3.7.0
  </verify>
  <done>
- Recharts 3.7.0 installed in package.json
- src/lib/constants.ts exists with CATEGORY_COLORS export
- src/lib/chart-data.ts exists with aggregateByCategory and aggregateByMonth exports
- TypeScript compilation succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Create category breakdown chart component</name>
  <files>
    src/components/charts/category-breakdown.tsx
  </files>
  <action>
Create `src/components/charts/category-breakdown.tsx` with Recharts pie chart:

Use 'use client' directive (Recharts requires client-side rendering)

Import:
- ResponsiveContainer, PieChart, Pie, Cell, Legend from 'recharts'
- CATEGORY_COLORS from @/lib/constants
- Category type from @/types

Component props:
- `data: Record<Category, number>` - category totals from parent (already memoized)

Chart configuration (following user decisions from CONTEXT.md):
- Use PieChart (or Doughnut via innerRadius) - choose whichever looks better for 5 categories
- ResponsiveContainer with width="100%" height={300}
- Map data to array format for Recharts: `[{ name: category, value: amount }, ...]`
- Use Cell components to apply CATEGORY_COLORS to each pie slice
- Include Legend component with onClick toggle to hide/show categories (Recharts built-in feature)
- NO hover tooltips (user specified legend toggle only)
- NO click-to-drill-down (user specified simple interactivity)

Empty state handling:
- If all category totals are 0, show friendly message: "No expenses yet. Start by adding an expense!"
- Can use a simple div with centered text instead of rendering empty chart

Styling with Tailwind classes for layout and spacing

Use IDR formatting for legend labels - import formatIDR from @/lib/money
  </action>
  <verify>
Check file exists and exports component:
```bash
grep -n "export.*CategoryBreakdown" src/components/charts/category-breakdown.tsx
```

Verify Recharts imports:
```bash
grep -n "from 'recharts'" src/components/charts/category-breakdown.tsx
```

TypeScript check:
```bash
npx tsc --noEmit
```
  </verify>
  <done>
- src/components/charts/category-breakdown.tsx exists
- Component imports ResponsiveContainer, PieChart, Pie, Cell, Legend from recharts
- Component uses CATEGORY_COLORS for consistent category colors
- Legend supports click toggle to hide/show categories
- Empty state handled with friendly message
- TypeScript compilation succeeds
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate category chart into Monthly page</name>
  <files>
    src/app/(dashboard)/monthly/page.tsx
  </files>
  <action>
Update existing Monthly page to include category breakdown chart:

Import:
- CategoryBreakdown from @/components/charts/category-breakdown
- aggregateByCategory from @/lib/chart-data
- useMemo from 'react'

Data flow:
1. Get transactions for selected month (already in current implementation)
2. Use useMemo to aggregate category data:
   ```typescript
   const categoryData = useMemo(() => {
     return aggregateByCategory(transactions, selectedMonth)
   }, [transactions, selectedMonth])
   ```
3. Pass memoized data to CategoryBreakdown component

Layout structure (update existing Monthly page):
- Keep existing month selector dropdown at top
- Keep existing summary cards (Total expense, Total income, Net amount)
- Add new section BELOW summary cards for category breakdown chart
- Use Card component (from shadcn/ui) to wrap chart with title "Spending by Category"
- Maintain responsive layout with Tailwind grid classes

IMPORTANT: Monthly page should NOT show full transaction list (per user decision in CONTEXT.md - "NO full transaction list on Monthly page"). Transaction list is on History page only. Monthly page = summary cards + charts only.

Performance: useMemo ensures aggregation only recalculates when selectedMonth changes, not on every render
  </action>
  <verify>
Check Monthly page imports CategoryBreakdown:
```bash
grep -n "CategoryBreakdown" src/app/(dashboard)/monthly/page.tsx
```

Check useMemo usage for aggregation:
```bash
grep -n "useMemo" src/app/(dashboard)/monthly/page.tsx
```

Build check:
```bash
npm run build
```
Should complete without errors.
  </verify>
  <done>
- Monthly page imports and renders CategoryBreakdown component
- Data aggregation uses useMemo for performance
- Chart appears below summary cards in responsive layout
- Build succeeds without errors
- Category chart displays on Monthly page with fixed colors and legend toggle
  </done>
</task>

</tasks>

<verification>
After task completion, verify phase goals:

1. Manual check: Run `npm run dev`, navigate to Monthly page
2. Verify category chart appears with 5 color-coded slices (if data exists)
3. Verify empty state message shows if no expenses (test with fresh localStorage)
4. Click legend items to verify hide/show toggle works
5. Verify colors are consistent and visually distinct
6. Check responsive behavior by resizing browser window
</verification>

<success_criteria>
- User can see category breakdown chart on Monthly page
- Each category has a fixed, consistent color across all views
- User can click legend to hide/show specific categories
- Chart displays even with minimal data (no minimum threshold)
- Empty state shows friendly guidance message
- Page loads performantly with memoized aggregation
</success_criteria>

<output>
After completion, create `.planning/phases/02-dashboard-visualization/02-01-SUMMARY.md`
</output>
